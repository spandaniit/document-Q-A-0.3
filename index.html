<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Document Q&A</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background:#f5f7fb; color:#111; padding:20px; }
    .container { max-width:1000px; margin:0 auto; background:white; padding:20px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
    h1 { margin-top:0; }
    form { margin-bottom:20px; }
    .docs { margin: 12px 0; }
    .doc-item { padding:8px 10px; border:1px solid #eee; margin-bottom:8px; border-radius:6px; display:flex; justify-content:space-between; align-items:center; }
    .btn { background:#0b74de; color:white; padding:8px 12px; border-radius:6px; text-decoration:none; border:none; cursor:pointer; }
    .btn.secondary { background:#6b7280; }
    .answer-box { background:#f8fafc; border:1px solid #e6eef9; padding:12px; border-radius:6px; margin-top:10px; }
    .sources { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px; }
    pre { white-space:pre-wrap; word-break:break-word; }
    /* Reset & Fonts */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
  background: linear-gradient(135deg, #1e3c72, #2a5298);
  min-height: 100vh;
  color: #f4f4f4;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 30px;
}

/* Container */
.container {
  background: rgba(255, 255, 255, 0.08);
  padding: 25px 30px;
  border-radius: 15px;
  width: 100%;
  max-width: 800px;
  box-shadow: 0px 8px 25px rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
}

/* Heading */
h1 {
  text-align: center;
  margin-bottom: 20px;
  color: #ffffff;
  font-size: 2rem;
  letter-spacing: 1px;
}

/* File upload */
input[type="file"] {
  display: block;
  margin: 15px auto;
  padding: 10px;
  background: #ffffff;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-size: 1rem;
}

input[type="file"]::-webkit-file-upload-button {
  background: #2a5298;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
  transition: background 0.3s;
}

input[type="file"]::-webkit-file-upload-button:hover {
  background: #1e3c72;
}

/* Question input */
input[type="text"] {
  width: 100%;
  padding: 12px;
  margin: 15px 0;
  border-radius: 10px;
  border: none;
  outline: none;
  font-size: 1rem;
  background: rgba(255, 255, 255, 0.85);
  color: #333;
}

/* Dynamic Button */
button {
  display: block;
  width: 100%;
  padding: 12px;
  background: linear-gradient(135deg, #ff9800, #ff5722);
  color: #fff;
  border: none;
  border-radius: 10px;
  font-size: 1.1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

button:hover {
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3);
}

button:active {
  transform: scale(0.97);
}

/* Loading effect inside button */
button.loading {
  background: #888 !important;
  cursor: not-allowed;
}

button.loading::after {
  content: "‚è≥ Processing...";
  position: absolute;
  left: 0;
  right: 0;
  text-align: center;
  color: #fff;
  font-weight: bold;
}

/* Answer box */
.answer-box {
  background: rgba(0, 0, 0, 0.3);
  padding: 15px;
  margin-top: 20px;
  border-radius: 12px;
  color: #fff;
  font-size: 1.05rem;
  line-height: 1.5;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Footer */
footer {
  text-align: center;
  margin-top: 20px;
  color: #ddd;
  font-size: 0.9rem;
}
  </style>
</head>
<body>
  <div class="container">
    <h1>üìò Document Q&A</h1>

    <section>
      <h3>1) Upload document (PDF / .txt / .md)</h3>
      <form action="/upload" method="post" enctype="multipart/form-data">
        <input type="file" name="file" accept=".pdf,.txt,.md" required />
        <button class="btn" type="submit">Upload & Process</button>
      </form>
    </section>

    <section>
      <h3>2) Uploaded documents</h3>
      <div class="docs">
        {% if docs %}
          {% for d in docs %}
            <div class="doc-item">
              <div>
                <strong>{{ d.filename }}</strong><br/>
                <small>{{ d.n_chunks }} chunks</small>
              </div>
              <div>
                <form action="/ask" method="post" style="display:inline-block; margin-right:8px;">
                  <input type="hidden" name="doc_id" value="{{ d.id }}" />
                  <input type="text" name="question" placeholder="Ask a question about this doc" style="width:320px; padding:6px;" value="{{ question if selected_doc==d.id else '' }}" />
                  <input type="hidden" name="k" value="4" />
                  <button class="btn" type="submit">Ask</button>
                </form>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div>No documents uploaded yet.</div>
        {% endif %}
      </div>
    </section>

    {% if answer %}
    <section>
      <h3>Answer</h3>
      <div class="answer-box">
        <pre>{{ answer }}</pre>
      </div>

      <h4>Sources (top chunks)</h4>
      <div class="sources">
        {% for s in sources %}
          <div style="background:#fff; border:1px solid #eee; padding:8px; border-radius:6px;">
            <strong>Chunk {{ s.index }}</strong> <small>(score: {{ "%.3f"|format(s.score) }})</small>
            <hr/>
            <div style="font-size:13px;"><pre>{{ s.text }}</pre></div>
          </div>
        {% endfor %}
      </div>
    </section>
    {% endif %}

  </div>
</body>
</html>